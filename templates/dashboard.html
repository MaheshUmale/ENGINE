<!DOCTYPE html>
<html>
<head>
    <title>Symmetry Engine Dashboard</title>
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css">
    <style>
        body { background-color: #f8f9fa; }
        .card { margin-top: 20px; box-shadow: 0 4px 6px rgba(0,0,0,0.1); }
        .positive { color: green; font-weight: bold; }
        .negative { color: red; font-weight: bold; }
        .signal-buy-ce { border-left: 5px solid green; }
        .signal-buy-pe { border-left: 5px solid red; }
    </style>
</head>
<body>
<nav class="navbar navbar-dark bg-dark">
    <div class="container">
        <span class="navbar-brand mb-0 h1">Triple-Stream Symmetry Engine</span>
    </div>
</nav>

<div class="container">
    <div class="row">
        <div class="col-md-4">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Total PnL</h5>
                    <p class="card-text h2 {% if total_pnl >= 0 %}positive{% else %}negative{% endif %}">
                        {{ "%.2f"|format(total_pnl) }}
                    </p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Trades</h5>
                    <p class="card-text h2">{{ trade_count }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Win Rate</h5>
                    <p class="card-text h2">{{ "%.1f"|format(win_rate) }}%</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Max DD</h5>
                    <p class="card-text h2 negative">{{ "%.0f"|format(max_drawdown) }}</p>
                </div>
            </div>
        </div>
        <div class="col-md-2">
            <div class="card text-center">
                <div class="card-body">
                    <h5 class="card-title">Sharpe</h5>
                    <p class="card-text h2">{{ "%.2f"|format(sharpe_ratio) }}</p>
                </div>
            </div>
        </div>
    </div>

    {% if equity_chart %}
    <div class="row">
        <div class="col-12">
            <div class="card">
                <div class="card-body" id="equity-chart"></div>
            </div>
        </div>
    </div>
    {% endif %}

    {% if error %}
    <div class="alert alert-warning mt-4">{{ error }}</div>
    {% endif %}

    <div class="row">
        <div class="col-md-7">
            <div class="card">
                <div class="card-header bg-primary text-white">Recent Trades</div>
                <div class="card-body">
                    <table class="table table-striped table-hover">
                        <thead>
                            <tr>
                                <th>Time</th>
                                <th>Index</th>
                                <th>Side</th>
                                <th>Price</th>
                                <th>PnL</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for trade in trades %}
                            <tr>
                                <td>{{ trade.timestamp }}</td>
                                <td>{{ trade.index_name }}</td>
                                <td><span class="badge {% if trade.side == 'BUY' %}bg-success{% else %}bg-warning{% endif %}">{{ trade.side }}</span></td>
                                <td>{{ trade.price }}</td>
                                <td class="{% if trade.pnl > 0 %}positive{% elif trade.pnl < 0 %}negative{% endif %}">
                                    {{ "%.2f"|format(trade.pnl) if trade.pnl else '-' }}
                                </td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>
                </div>
            </div>
        </div>
        <div class="col-md-5">
            <div class="card">
                <div class="card-header bg-dark text-white">Recent Signals</div>
                <div class="card-body">
                    {% for signal in signals %}
                    <div class="alert mb-2 {% if signal.side == 'BUY_CE' %}alert-success signal-buy-ce{% else %}alert-danger signal-buy-pe{% endif %}">
                        <strong>{{ signal.side }}</strong> at {{ signal.timestamp }}<br>
                        <small>Index: {{ signal.index_price }} | Option: {{ signal.option_price }} | Score: {{ signal.confluence_score }}/4</small>
                    </div>
                    {% endfor %}
                </div>
            </div>
        </div>
    </div>
</div>

<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
<script src="https://cdn.plot.ly/plotly-2.24.1.min.js"></script>
{% if equity_chart %}
<script>
    var chartData = {{ equity_chart | safe }};
    Plotly.newPlot('equity-chart', chartData.data, chartData.layout);
</script>
{% endif %}
</body>
</html>
