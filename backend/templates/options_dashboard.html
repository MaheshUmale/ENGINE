<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PRODESK | Side-by-Side Options Dashboard</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <script src="https://cdn.socket.io/4.7.2/socket.io.min.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Plus+Jakarta+Sans:ital,wght@0,400;0,500;0,600;0,700;0,800;1,800&display=swap');

        :root {
            --bg-main: #0f172a;
            --bg-panel: rgba(30, 41, 59, 0.7);
            --text-primary: #f8fafc;
            --text-muted: #94a3b8;
            --border-subtle: rgba(255, 255, 255, 0.05);
            --color-primary: #3b82f6;
            --input-bg: #1e293b;
            --btn-bg-muted: #334155;
            --btn-text: #ffffff;
        }

        body.light-theme {
            --bg-main: #f1f5f9;
            --bg-panel: rgba(255, 255, 255, 0.9);
            --text-primary: #0f172a;
            --text-muted: #475569;
            --border-subtle: rgba(0, 0, 0, 0.1);
            --input-bg: #ffffff;
            --btn-bg-muted: #e2e8f0;
            --btn-text: #0f172a;
        }

        body { font-family: 'Plus Jakarta Sans', sans-serif; background-color: var(--bg-main); color: var(--text-primary); transition: background-color 0.3s, color 0.3s; -webkit-font-smoothing: antialiased; letter-spacing: -0.01em; font-size: 11px; }
        .glass-panel { background: var(--bg-panel); backdrop-filter: blur(16px); border: 1px solid var(--border-subtle); box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1), 0 2px 4px -1px rgba(0, 0, 0, 0.06); }
        .custom-scrollbar::-webkit-scrollbar { width: 4px; height: 4px; }
        .custom-scrollbar::-webkit-scrollbar-track { background: transparent; }
        .custom-scrollbar::-webkit-scrollbar-thumb { background: #334155; border-radius: 10px; }

        .mini-card { padding: 0.5rem 0.5rem 0.125rem 0.5rem; border-radius: 0.75rem; }
        .mini-chart-container { height: 120px; position: relative; margin-bottom: -0.125rem; }
        .mini-text { font-size: 8px; line-height: 1; }
        .mini-header { font-size: 9px; font-weight: 800; text-transform: uppercase; letter-spacing: 0.025em; margin-bottom: 0.25rem; color: var(--text-muted); }

        canvas { width: 100% !important; height: 100% !important; }
    </style>
</head>
<body class="h-full flex flex-col overflow-hidden custom-scrollbar">
    <!-- Header -->
    <header class="h-10 py-1 glass-panel border-b border-white/5 px-4 flex items-center justify-between shrink-0">
        <div class="flex items-center gap-4">
            <a href="/" class="text-xs font-black text-white italic tracking-tighter uppercase shrink-0">
                PRO<span class="text-blue-500">DESK</span> <span class="text-[9px] not-italic font-bold text-gray-500 ml-1">OPTIONS SIDE-BY-SIDE</span>
            </a>
            <div class="flex items-center gap-3 mini-text text-gray-400">
                <span>Source: <span id="dataSource" class="text-green-400 font-bold">Live Feed</span></span>
                <span>Updated: <span id="lastUpdated" class="text-blue-400 font-bold">-</span></span>
            </div>
        </div>
        <div class="flex items-center gap-2">
            <div class="flex items-center gap-1 bg-black/30 p-0.5 rounded-full border border-white/10 shadow-inner">
                <button id="refreshBtn" class="bg-blue-600 hover:bg-blue-500 text-white text-[8px] font-black px-4 py-1 rounded-full transition-all uppercase tracking-tighter shadow-lg shadow-blue-500/20 active:scale-95">REFRESH</button>
                <button id="backfillBtn" class="bg-slate-700 hover:bg-slate-600 text-white text-[8px] font-black px-4 py-1 rounded-full transition-all uppercase tracking-tighter ml-1 active:scale-95">BACKFILL</button>
            </div>
            <button id="optionsThemeToggle" class="p-1.5 hover:bg-white/5 rounded-full text-gray-400 transition-colors" title="Toggle Theme">
                <svg id="optionsSunIcon" class="hidden w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path fill-rule="evenodd" d="M10 2a1 1 0 011 1v1a1 1 0 11-2 0V3a1 1 0 011-1zm4 8a4 4 0 11-8 0 4 4 0 018 0zm-.464 4.95l.707.707a1 1 0 001.414-1.414l-.707-.707a1 1 0 00-1.414 1.414zm2.12-10.607a1 1 0 010 1.414l-.706.707a1 1 0 11-1.414-1.414l.707-.707a1 1 0 011.414 0zM17 11a1 1 0 100-2h-1a1 1 0 100 2h1zm-7 4a1 1 0 011 1v1a1 1 0 11-2 0v-1a1 1 0 011-1zM5.05 6.464A1 1 0 106.465 5.05l-.708-.707a1 1 0 00-1.414 1.414l.707.707zm1.414 8.486l-.707.707a1 1 0 01-1.414-1.414l.707-.707a1 1 0 011.414 1.414zM4 11a1 1 0 100-2H3a1 1 0 000 2h1z" clip-rule="evenodd"/></svg>
                <svg id="optionsMoonIcon" class="w-3.5 h-3.5" fill="currentColor" viewBox="0 0 20 20"><path d="M17.293 13.293A8 8 0 016.707 2.707a8.001 8.001 0 1010.586 10.586z"/></svg>
            </button>
        </div>
    </header>

    <!-- Main Content -->
    <main class="flex-1 overflow-hidden p-2 flex gap-2">
        <!-- Helper function for Index Column -->
        <script>
            function createIndexColumn(idPrefix, displayName) {
                return `
                <div class="flex-1 flex flex-col gap-2 overflow-hidden">
                    <div class="flex justify-between items-center px-1">
                        <h2 class="text-xs font-black text-blue-500 uppercase">${displayName}</h2>
                        <div class="flex gap-4 mini-text">
                            <div class="text-right">
                                <span class="text-gray-500 uppercase font-bold">Spot</span>
                                <span id="${idPrefix}_spotPrice" class="text-white font-black ml-1">0.00</span>
                            </div>
                        </div>
                    </div>

                    <!-- Genie Card -->
                    <div class="glass-panel mini-card border-l-2 border-blue-500 flex flex-col gap-1 shrink-0">
                        <div class="flex justify-between items-start">
                            <div class="mini-text text-blue-500 font-black uppercase">OiGenie Control</div>
                            <div id="${idPrefix}_genieRange" class="mini-text text-blue-400 font-bold">-</div>
                        </div>
                        <div class="flex items-center justify-between">
                            <div id="${idPrefix}_genieControl" class="text-xs font-black text-white uppercase">-</div>
                            <div id="${idPrefix}_genieDistribution" class="mini-text text-gray-500 uppercase">-</div>
                            <div class="text-right">
                                <span class="mini-text text-gray-500 uppercase font-bold">Max Pain</span>
                                <span id="${idPrefix}_maxPain" class="mini-text text-purple-500 font-black ml-1">-</span>
                            </div>
                        </div>
                        <!-- PCR Trend Mini -->
                        <div class="flex items-center gap-2 mt-1">
                            <span class="mini-text text-gray-500 uppercase font-bold">PCR</span>
                            <span id="${idPrefix}_currentPcrValue" class="mini-text font-black text-blue-500">-</span>
                            <div class="flex-1 h-4">
                                <canvas id="${idPrefix}_pcrTrendChart"></canvas>
                            </div>
                        </div>
                    </div>

                    <!-- Charts Grid -->
                    <div class="flex-1 grid grid-cols-1 gap-2 overflow-y-auto custom-scrollbar pr-1">
                        <!-- 1. Flow -->
                        <div class="glass-panel mini-card flex flex-col">
                            <div class="mini-header">CE vs PE OI Flow</div>
                            <div class="mini-chart-container">
                                <canvas id="${idPrefix}_ceVsPeChangeChart"></canvas>
                            </div>
                        </div>

                        <!-- 2. Multi-Trend -->
                        <div class="glass-panel mini-card flex flex-col">
                            <div class="mini-header">OI Change Multi-Trend</div>
                            <div class="mini-chart-container">
                                <canvas id="${idPrefix}_oiDiffChart"></canvas>
                            </div>
                        </div>

                        <!-- 3. Strike Chg -->
                        <div class="glass-panel mini-card flex flex-col">
                            <div class="flex justify-between items-center mb-1">
                                <div class="mini-header mb-0">Strike OI Change</div>
                                <div class="flex gap-2 mini-text">
                                    <span id="${idPrefix}_totalCallOiChg" class="text-red-500 font-bold">0</span>
                                    <span id="${idPrefix}_totalPutOiChg" class="text-green-500 font-bold">0</span>
                                </div>
                            </div>
                            <div class="mini-chart-container">
                                <canvas id="${idPrefix}_strikeWiseOiChangeChart"></canvas>
                            </div>
                        </div>

                        <!-- 4. Strike Total -->
                        <div class="glass-panel mini-card flex flex-col">
                            <div class="flex justify-between items-center mb-1">
                                <div class="mini-header mb-0">Strike Total OI</div>
                                <div class="flex gap-2 mini-text">
                                    <span id="${idPrefix}_totalCallOi" class="text-red-500 font-bold">0</span>
                                    <span id="${idPrefix}_totalPutOi" class="text-green-500 font-bold">0</span>
                                </div>
                            </div>
                            <div class="mini-chart-container">
                                <canvas id="${idPrefix}_strikeWiseTotalOiChart"></canvas>
                            </div>
                        </div>
                    </div>
                </div>
                `;
            }

            document.write(createIndexColumn('nifty', 'NIFTY 50'));
            document.write('<div class="w-px bg-white/5 h-full"></div>');
            document.write(createIndexColumn('banknifty', 'BANKNIFTY'));
        </script>
    </main>

    <script src="/static/options_dashboard_app.js"></script>
</body>
</html>
